<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Acme Packet SBC and Configuring Codec Policies for SIP Call Flows &middot; Mark Holloway
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://localhost:4000/public/css/poole_custom.css">
  <link rel="stylesheet" href="/public/css/syntax_dracula.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/hyde_custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface|Press+Start+2P|Exo+2:700">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">



  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Force https -->
  
  <script>
    var host = 'markholloway.github.io';
    if (window.location.host == host && window.location.protocol != 'https:') {
        window.location.protocol = 'https:';
    }
</script>

  

  <!-- Jekyll SEO tag plugin -->
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Acme Packet SBC and Configuring Codec Policies for SIP Call Flows | Mark Holloway</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Acme Packet SBC and Configuring Codec Policies for SIP Call Flows" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Acme Packet Session Director (often referred to as a Session Border Controller) has the flexibility of re-ordering or completely removing certain codecs from SDP (Session Description Protocol) before passing a SIP Invite to the destination SIP endpoint." />
<meta property="og:description" content="The Acme Packet Session Director (often referred to as a Session Border Controller) has the flexibility of re-ordering or completely removing certain codecs from SDP (Session Description Protocol) before passing a SIP Invite to the destination SIP endpoint." />
<link rel="canonical" href="http://localhost:4000/2011/02/20/acme-packet-sbc-code-policy/" />
<meta property="og:url" content="http://localhost:4000/2011/02/20/acme-packet-sbc-code-policy/" />
<meta property="og:site_name" content="Mark Holloway" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-02-20T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@twilion2" />
<script type="application/ld+json">
{"description":"The Acme Packet Session Director (often referred to as a Session Border Controller) has the flexibility of re-ordering or completely removing certain codecs from SDP (Session Description Protocol) before passing a SIP Invite to the destination SIP endpoint.","@type":"BlogPosting","url":"http://localhost:4000/2011/02/20/acme-packet-sbc-code-policy/","headline":"Acme Packet SBC and Configuring Codec Policies for SIP Call Flows","dateModified":"2011-02-20T00:00:00-05:00","datePublished":"2011-02-20T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2011/02/20/acme-packet-sbc-code-policy/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131536379-1', 'auto');
  ga('send', 'pageview');

</script>



  <body>
    
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Mark Holloway
        </a>
      </h1>
      <p class="lead">Turning Telco into Code</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <p>
        <a class="sidebar-nav-icons" href="https://github.com/markholloway" target="blank"><img src="/public/GitHub-Mark-Light-32px.png" alt="Github" width="18" height="18"></a>
        <a class="sidebar-nav-icons" href="http://www.linkedin.com/in/mholloway/" target="blank"><img src="/public/linkedin.png" alt="LinkedIn" width="19" height="19"></a>
      </p>

    </nav>

    <p><small>&copy; 2019 All rights reserved.</small></p>
  </div>
</div>


    <div class="content container">
      



<div class="post">
  <h1 class="post-title">Acme Packet SBC and Configuring Codec Policies for SIP Call Flows</h1>
  <span class="post-date">20 Feb 2011 <i class="fa fa-tags"></i> <a href="/blog/tag/acme/">#acme packet</a> <!--comma--><a href="/blog/tag/sbc/">#sbc</a> <!--comma--><a href="/blog/tag/sip/">#sip</a> </span>

  <p>The Acme Packet Session Director (often referred to as a Session Border Controller) has the flexibility of re-ordering or completely removing certain codecs from SDP (Session Description Protocol) before passing a SIP Invite to the destination SIP endpoint.</p>

<!--more-->

<p>Codec re-ordering or stripping is useful in cases where the originating device may be sending a particular codec that is not supported (or preferred) by the far.  For example, a SIP peering destination may only allow certain codecs to be contained in SIP Invites originating from your network.  If a device is sending G722, G711, G726, and G729 but the far end explicitly states only G722 and G711 are permitted, a policy must exist somewhere in the network that complies with the requirements of the far end.  Some SIP endpoints provide control over which codecs are permitted in SDP, but this is not always the case and therefore the Acme Session Director is able to provide global enforcement over all endpoints to ensure they comply.  Using the SD also drastically simplifies SIP endpoint management by avoiding tedious configuration of individual configurations for various devices.</p>

<p>The Session Director has the ability to perform codec policy enforcement on an incoming policy or an outgoing policy. The incoming policy is great if you want to achieve the same result for every incoming call regardless of what realm the call will egress.  Configuring on the egress allows customization where perhaps one realm may order the codec list one way while another realm orders the codec list another way as the call leaves the Session Director depending on which destination the SIP Invite is sent to.</p>

<p>The diagram illustrates the scenario above where an endpoint is sending more codec than what is permitted by the far end. The Acme Session Director has the ability to re-write the SDP before sending the SIP Invite to the far end.</p>

<p><img src="/blog/assets/apkt/apkt-codec-policy.png" alt="" /></p>

<p>First, start by going into configuration mode and enter the codec-policy configuration.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500# conf t
lab-sd4500(configure)# media-manager
lab-sd4500(media-manager)# codec-policy
lab-sd4500(codec-policy)# &lt;policy name&gt;

</code></pre></div></div>

<p>This very basic example allows all codecs in the SDP to pass through. The * symbol represents a wildcard. This is effectively the same as having no codec policy.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500(codec-policy)# allow-codecs *

</code></pre></div></div>

<p>The next example allows all codecs except for G729 to pass through.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500(codec-policy)# allow-codecs * G729:no

</code></pre></div></div>

<p>The next example removes all codecs from the SDP.  If the far end device is in compliance with RFC 3264 (offer/answer with SDP) it will supply a new SDP in response to the SIP Invite.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500(codec-policy)# allow-codecs * audio:no

</code></pre></div></div>

<p>The next example demonstrates a SIP endpoint that originates a SIP Invite which contains G711 and G729, but only G729 should be passed to the far end. However, if the originating device had sent a SIP Invite that contains G711 but does not contain G729 then G711 is permitted to be included in the SDP to the far end SIP endpoint.  Essentially, the word force is stating that if G729 is present in the original Invite, regardless of whether G711 is present, then only send G729 to the far end. If G729 is not present but G711 is present, go ahead and send G711.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500(codec-policy)# allow PCMU G729:force

</code></pre></div></div>

<p>Next is an example of a codec-policy which needs to be associated with a Session Agent (ie. target SIP endpoint such as a PSTN SIP Peering Provider, also referred to as an ITSP) or a Realm. The purpose of this policy is to strip G726 from SDP as well as strip any video offering. The policy is given a name which references its actual purpose. This is something I tend to do quite frequently on the SD as the configuration can get quite large and this helps keep track of policies. The end result is that G711 will be the preferred codec offered in SDP to the ITSP.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
codec-policy
    name s          trip-726-video
    allow-codecs    g726:no pcmu video:no
    order-codecs    pcmu

</code></pre></div></div>

<p>After creating the codec-policy above we may associate it with a Session Agent so it is enforced.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500# configure terminal
lab-sd4500(configure)# session-router
lab-sd4500(session-router)# session-agent
lab-sd4500(session-agent)# select

1. ITSP A
2. ITSP B
3. ITSP C

&gt; 3

lab-sd4500(session-agent)# codec-policy strip-726-video
lab-sd4500(session-agent)# done
lab-sd4500(session-agent)# exit
lab-sd4500(session-router)# exit
lab-sd4500(configure)# exit
lab-sd4500# save-config
lab-sd4500# verify-config
No errors found
lab-sd4500# activate-config

</code></pre></div></div>

<p>Associating the policy with a Session Agent means all calls which traverse through that particular Session Agent will have the codec-policy enforced.  If the policy should be Realm specific rather than Session Agent specific then perform the following instead.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
lab-sd4500# configure terminal
lab-sd4500(configure)# media-manager
lab-sd4500(media-manager)# realm-config
lab-sd4500(realm-config)# select

1. Access
2. Core
3. Peering ITSP Core

&gt; 3

lab-sd4500(realm-config)# codec-manip-in-realm strip-726-video
lab-sd4500(realm-config)# done
lab-sd4500(realm-config)# exit
lab-sd4500(media-manager)# exit
lab-sd4500(configure)# exit
lab-sd4500# save-config
lab-sd4500# verify-config
No errors found
lab-sd4500# activate-config

</code></pre></div></div>

<p>The examples provided only scratch the surface and are a basic introduction to the topic of codec policies. All of this and more may be found in the ACLI documentation. The Session Director is an incredibly flexible platform and I continuously find it fascinating how granular one can get when it comes to controlling their voice network.</p>



</div>

<!--
<div class="donate">
</div>

-->



<!-- fluidvids.js -->
<script src="/public/js/fluidvids/dist/fluidvids.js"></script>
<script>
fluidvids.init({
  selector: ['iframe'],
  players: ['www.youtube.com', 'player.vimeo.com']
});
</script>



  <!-- Disqus comments. -->
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables

var disqus_config = function () {
this.page.url = 'http://localhost:4000/2011/02/20/acme-packet-sbc-code-policy/'; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = '/2011/02/20/acme-packet-sbc-code-policy/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/

/**

Using variables from _config.yml instead of static entries

*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//mh-blog-2.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



    </div>

  </body>
</html>
