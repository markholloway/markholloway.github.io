<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    <title>Decoupling the ORM class from the data model class | Mark Holloway</title>
    <meta name="description" content="Notes from a curiosity-driven engineer.">
    <link rel="canonical" href="http://localhost:1313/blog/2023/07/02/decoupling-the-orm-class-from-the-data-model-class/">
    
    
    <meta property="og:url" content="http://localhost:1313/blog/2023/07/02/decoupling-the-orm-class-from-the-data-model-class/">
  <meta property="og:site_name" content="Mark Holloway">
  <meta property="og:title" content="Decoupling the ORM class from the data model class">
  <meta property="og:description" content="I’m working on a rather large project where we would want to replace a WSGI ORM with an ASGI ORM, but it’s tangled up into everything and ORM queries are executed from all over the business logic. If the ORM would’ve been decoupled from the objects tossed around in the business logic, it would’ve been much easier to replace the ORM.
This blog post outlines an example of how this can be done with Pydantic. I’m also including a “bonus section” on decoupling the data store communication from the business logic with some inspiration of the “Repository pattern”.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2023-07-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-07-02T00:00:00+00:00">
    <meta property="article:tag" content="Python">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Decoupling the ORM class from the data model class">
  <meta name="twitter:description" content="I’m working on a rather large project where we would want to replace a WSGI ORM with an ASGI ORM, but it’s tangled up into everything and ORM queries are executed from all over the business logic. If the ORM would’ve been decoupled from the objects tossed around in the business logic, it would’ve been much easier to replace the ORM.
This blog post outlines an example of how this can be done with Pydantic. I’m also including a “bonus section” on decoupling the data store communication from the business logic with some inspiration of the “Repository pattern”.">

    
    
    
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Decoupling the ORM class from the data model class",
  "datePublished": "2023-07-02T00:00:00Z",
  "dateModified": "2023-07-02T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http:\/\/localhost:1313\/blog\/2023\/07\/02\/decoupling-the-orm-class-from-the-data-model-class\/"
  },
  "author": {
    "@type": "Person",
    "name": "map[]"
  },
  "description": "I\u0026rsquo;m working on a rather large project where we would want to replace a WSGI ORM with an ASGI ORM, but it\u0026rsquo;s tangled up into everything and ORM queries are executed from all over the business logic. If the ORM would\u0026rsquo;ve been decoupled from the objects tossed around in the business logic, it would\u0026rsquo;ve been much easier to replace the ORM.\nThis blog post outlines an example of how this can be done with Pydantic. I\u0026rsquo;m also including a \u0026ldquo;bonus section\u0026rdquo; on decoupling the data store communication from the business logic with some inspiration of the \u0026ldquo;Repository pattern\u0026rdquo;.\n"
}
</script>



    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    
    <link rel="preload" href="/fonts/BerkeleyMono-Variable.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/CommitMono-Variable.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/MapleMono-Italic.woff2" as="font" type="font/woff2" crossorigin>
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/github-link.css" />
    
    <script defer src="https://cloud.umami.is/script.js" data-website-id="29980893-435d-4d73-962b-e2b6e505fb7e"></script>

  </head>

  <body class="preload">
    <script>
      (function() {
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.body.classList.add(savedTheme);
        } else {
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark');
          }
        }
        
        
        if ('fonts' in document) {
          
          Promise.race([
            document.fonts.ready,
            new Promise(resolve => setTimeout(resolve, 100)) 
          ]).then(() => {
            document.body.classList.remove('preload');
          });
        } else {
          
          setTimeout(() => {
            document.body.classList.remove('preload');
          }, 50);
        }
      })();
    </script>

    <nav style="display: flex; align-items: center; gap: 1em; flex-wrap: wrap;">
      <ul class="menu" style="margin: 0; padding: 0; flex-shrink: 0;">
        
        
        <li><a  href="/">Home</a></li>
        
        <li><a  href="/blog/">Blog</a></li>
        
        <li><a  href="/about/">About</a></li>
        
        <li><button id="theme-toggle" style="background:none; border:none; cursor:pointer; font-size:1em; padding:5px; color:inherit;">◑</button></li>
      </ul>
      
      
      <div id="search" style="flex-grow: 1; min-width: 200px;"></div>
    </nav>
    
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ 
              element: "#search", 
              showSubResults: true,
              showImages: false,
              translations: {
                placeholder: "Search...",
                clear_search: "×"
              }
            });

            
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('#search');
                if (searchContainer && !searchContainer.contains(e.target)) {
                    const clearButton = searchContainer.querySelector('.pagefind-ui__search-clear');
                    if (clearButton) {
                        clearButton.click();
                    }
                }
            });

            
            const toggle = document.getElementById('theme-toggle');
            const body = document.body;

            toggle.addEventListener('click', () => {
              if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                body.classList.add('light');
                localStorage.setItem('theme', 'light');
              } else {
                body.classList.remove('light');
                body.classList.add('dark');
                localStorage.setItem('theme', 'dark');
              }
            });
        });
    </script>


<div class="article-meta">
<h1><span class="title">Decoupling the ORM class from the data model class</span></h1>

<div class="article-meta-info">
  <span class="date">2023-07-02</span>
  
  <span class="article-tags">
    
    
    
    <a href="/tags/python">#python</a>
    
    
  </span>
  
</div>
</div>



<main data-pagefind-body>
	
	
		
		<aside class="table-of-contents">
			<div class="toc-title">
				<svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"
					fill="currentColor">
					<path
						d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z">
					</path>
				</svg>
				Table of Contents
			</div>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#defining-the-orm-models">Defining the ORM models</a></li>
    <li><a href="#defining-the-business-logic-entity-models">Defining the business logic entity models</a></li>
    <li><a href="#defining-the-repositories">Defining the repositories</a></li>
    <li><a href="#lets-run-some-commands">Let&rsquo;s run some commands!</a>
      <ul>
        <li><a href="#create-the-db-tables">Create the db tables</a></li>
        <li><a href="#communicate-with-the-db">Communicate with the db</a></li>
      </ul>
    </li>
    <li><a href="#a-final-note-on-switching-out-the-repositories">A final note on switching out the repositories</a></li>
    <li><a href="#over-engineering">Over-engineering</a></li>
  </ul>
</nav>
		</aside>
		

		<p>I&rsquo;m working on a rather large project where we would want to replace a 



<a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface" target="_blank" rel="noopener">WSGI</a> ORM with an 



<a href="https://en.wikipedia.org/wiki/Asynchronous_Server_Gateway_Interface" target="_blank" rel="noopener">ASGI</a> ORM, but it&rsquo;s tangled up into everything and ORM queries are executed from all over the business logic. If the ORM would&rsquo;ve been decoupled from the objects tossed around in the business logic, it would&rsquo;ve been much easier to replace the ORM.</p>
<p>This blog post outlines an example of how this can be done with 




  
  
  
  
  
  

  
    
    
    
  

  
  
  
    
  

  
  

  <a href="https://github.com/pydantic/pydantic" target="_blank" rel="noopener" class="github-link"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>Pydantic</a>. I&rsquo;m also including a &ldquo;bonus section&rdquo; on decoupling the data store communication from the business logic with some inspiration of the &ldquo;Repository pattern&rdquo;.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This post was written with Python 3.11 in mind. You&rsquo;ll need to install SQLAlchemy and Pydantic:</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pip</span> <span class="n">install</span> <span class="n">sqlalchemy</span><span class="o">==</span><span class="mf">2.</span><span class="o">*</span> <span class="n">pydantic</span><span class="o">==</span><span class="mf">2.</span><span class="o">*</span></span></span></code></pre></div></div>
<h2 id="defining-the-orm-models">Defining the ORM models</h2>
<p>Let&rsquo;s start with defining ORM models and related functions in <code>orm.py</code>:</p>
<blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    orm.py
  </div><div class="callout-content"><div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Engine</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">create_engine</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">declarative_base</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserOrm</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&#34;users&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div></div></div>
</blockquote><h2 id="defining-the-business-logic-entity-models">Defining the business logic entity models</h2>
<p>Let&rsquo;s now implement the internal &ldquo;entity&rdquo; model we&rsquo;ll use when passing around a user object in our business logic, in <code>entities.py</code>. Even if we replace the ORM or the database, this object likely won&rsquo;t change as it should still carry the same attributes and should not require refactorings to our business logic.</p>
<p>What&rsquo;s nice about using Pydantic models for such entities is we&rsquo;ll get the awesome validation Pydantic is known for, for &ldquo;free&rdquo;.</p>
<blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    entities.py
  </div><div class="callout-content"><div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ConfigDict</span><span class="p">,</span> <span class="n">Field</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></span></span></code></pre></div></div></div>
</blockquote><blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    Note
  </div><div class="callout-content"><p>Please note the <code>from_attributes</code> configuration. This is where the magic happens, as this enables creating the entity from the ORM object:</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">user_orm</span> <span class="o">=</span> <span class="n">UserOrm</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&#34;johndoe@gmail.com&#34;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&#34;hashed_password&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user_orm</span><span class="p">)</span></span></span></code></pre></div></div></div>
</blockquote><blockquote class="callout markdown-alert callout-tip markdown-alert-tip"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>
    Tip
  </div><div class="callout-content"><p>Note how the ORM model contains a <code>password</code> attribute, mapping to the database column of the same name. But in our business logic, I don&rsquo;t want this to be available. Therefore my entity model doesn&rsquo;t have it.</p></div>
</blockquote><h2 id="defining-the-repositories">Defining the repositories</h2>
<p>With the &ldquo;Repository pattern&rdquo;, you want to define a tight responsibility scope for the code which communicates with an external data store, such as a database. This code would be known as a &ldquo;repository&rdquo; and lives outside of your (likely domain-driven) business logic. The idea is to have your business logic call into this repository whenever it needs to interact with the external data source and allow the repository to be switched for another repository.</p>
<p>For example, you might want to use SQLAlchemy with Postgres in prod, but for tests maybe you want to use SQLAlchemy with an in-memory SQLite database for faster execution and less setup. Or maybe you want your app to gradually move over onto a different database, database driver, ORM or similar but without refactoring your business logic.</p>
<p>Let&rsquo;s define a couple of classes in <code>repositories.py</code>. First off, we define the abstract class <code>UserRepositoryAbc</code> that explains which required methods all user repositories must include. In this case it&rsquo;s the <code>create_user</code> and <code>get_all_users</code> methods. Then we implement the <code>UserRepository</code> class, which implements logic on how to communicate with our SQLite database using SQLAlchemy.</p>
<p>I&rsquo;m just going to call this repository <code>UserRepository</code> for now, but imagine we could&rsquo;ve had <code>UserSqlAlchemyRepository</code>, <code>UserMongoDbRepository</code>, <code>UserRedisRepository</code> or <code>UserFakeRepository</code>, all inheriting from <code>UserRepositoryAbc</code>. That last one, <code>UserFakeRepository</code>, could be used in tests and not even communicate with a real database.</p>
<blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    repositories.py
  </div><div class="callout-content"><div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">abc</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">entities</span> <span class="kn">import</span> <span class="n">User</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">orm</span> <span class="kn">import</span> <span class="n">Base</span><span class="p">,</span> <span class="n">UserOrm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserRepositoryAbc</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@abc.abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hashed_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@abc.abstractmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_all_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">(</span><span class="n">UserRepositoryAbc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">engine</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Engine</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&#34;sqlite:///mydatabase.db&#34;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hashed_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">user_orm</span> <span class="o">=</span> <span class="n">UserOrm</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user_orm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user_orm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_all_users</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">users_orm</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">UserOrm</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">UserOrm</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">users</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="n">User</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_orm</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">users</span></span></span></code></pre></div></div></div>
</blockquote><blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    A note on the table creation and inclusion of engine
  </div><div class="callout-content"><p>As you can see, I also added a methods <code>create_tables</code> and <code>engine</code>. These doesn&rsquo;t really belong on a users repository, and you might want to implement this on some general SQLAlchemy repository class or abstract the choice of database away from the ORM. But to avoid making this blog post too long and complicated, I just slapped them on there.</p>
<p>Note that all ORM models inherting from <code>Base</code> in <code>orm.py</code> will have all their respective tables created when executing <code>Base.metadata.create_all(engine)</code>.</p></div>
</blockquote><blockquote class="callout markdown-alert callout-tip markdown-alert-tip"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>
    Limit ORM queries to the repository
  </div><div class="callout-content"><p>The repository methods can take business logic entities (such as <code>User</code>) as input, or it can take strings, integers, booleans etc - or no arguments at all. It is likely desirable that it returns business logic entities but that is no strict rule about this. Just have them return what makes the most sense. Just don&rsquo;t return the ORM objects!</p>
<p>The idea is to limit all occurrences of ORM queries to the repositories and not implementing them in the business logic.</p></div>
</blockquote><h2 id="lets-run-some-commands">Let&rsquo;s run some commands!</h2>
<h3 id="create-the-db-tables">Create the db tables</h3>
<p>Let&rsquo;s begin by creating the db tables:</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">orm</span> <span class="kn">import</span> <span class="n">Base</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">repositories</span> <span class="kn">import</span> <span class="n">UserRepository</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">UserRepository</span><span class="p">()</span><span class="o">.</span><span class="n">create_tables</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">Base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">BEGIN</span> <span class="p">(</span><span class="n">implicit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">PRAGMA</span> <span class="n">main</span><span class="o">.</span><span class="n">table_info</span><span class="p">(</span><span class="s2">&#34;users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">602</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">raw</span> <span class="n">sql</span><span class="p">]</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">603</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">PRAGMA</span> <span class="n">temp</span><span class="o">.</span><span class="n">table_info</span><span class="p">(</span><span class="s2">&#34;users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">603</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">raw</span> <span class="n">sql</span><span class="p">]</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">603</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span>
</span></span><span class="line"><span class="cl"><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">users</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">email</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">603</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">no</span> <span class="n">key</span> <span class="mf">0.00006</span><span class="n">s</span><span class="p">]</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">47</span><span class="p">,</span><span class="mi">604</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">COMMIT</span></span></span></code></pre></div></div>
<h3 id="communicate-with-the-db">Communicate with the db</h3>
<p>Finally, we can now communicate with our database using the ORM but always return our entity objects rather than returning ORM objects directly. This is what we&rsquo;d also want our business logic to do, rather than manage the ORM directly.</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">repositories</span> <span class="kn">import</span> <span class="n">UserRepository</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">()</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;John Doe&#34;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&#34;johndoe@gmail.com&#34;</span><span class="p">,</span> <span class="n">hashed_password</span><span class="o">=</span><span class="s2">&#34;hashed_password&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">700</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">BEGIN</span> <span class="p">(</span><span class="n">implicit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">702</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="err">?</span><span class="p">,</span> <span class="err">?</span><span class="p">,</span> <span class="err">?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">702</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">generated</span> <span class="ow">in</span> <span class="mf">0.00024</span><span class="n">s</span><span class="p">]</span> <span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="s1">&#39;hashed_password&#39;</span><span class="p">,</span> <span class="s1">&#39;johndoe@gmail.com&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">703</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">COMMIT</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">706</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">BEGIN</span> <span class="p">(</span><span class="n">implicit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">708</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">SELECT</span> <span class="n">users</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">users_id</span><span class="p">,</span> <span class="n">users</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">users_name</span><span class="p">,</span> <span class="n">users</span><span class="o">.</span><span class="n">password</span> <span class="n">AS</span> <span class="n">users_password</span><span class="p">,</span> <span class="n">u</span>
</span></span><span class="line"><span class="cl"><span class="n">sers</span><span class="o">.</span><span class="n">email</span> <span class="n">AS</span> <span class="n">users_email</span>
</span></span><span class="line"><span class="cl"><span class="n">FROM</span> <span class="n">users</span>
</span></span><span class="line"><span class="cl"><span class="n">WHERE</span> <span class="n">users</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">708</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">generated</span> <span class="ow">in</span> <span class="mf">0.00015</span><span class="n">s</span><span class="p">]</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">15</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="mi">709</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">ROLLBACK</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">id</span><span class="o">=</span><span class="mi">1</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;John Doe&#39;</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;johndoe@gmail.com&#39;</span></span></span></code></pre></div></div>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">repositories</span> <span class="kn">import</span> <span class="n">UserRepository</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">users</span> <span class="o">=</span>  <span class="n">UserRepository</span><span class="p">()</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span>  <span class="n">UserRepository</span><span class="p">()</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span><span class="mi">858</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">BEGIN</span> <span class="p">(</span><span class="n">implicit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span><span class="mi">859</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">SELECT</span> <span class="n">users</span><span class="o">.</span><span class="n">id</span> <span class="n">AS</span> <span class="n">users_id</span><span class="p">,</span> <span class="n">users</span><span class="o">.</span><span class="n">name</span> <span class="n">AS</span> <span class="n">users_name</span><span class="p">,</span> <span class="n">users</span><span class="o">.</span><span class="n">password</span> <span class="n">AS</span> <span class="n">users_password</span>
</span></span><span class="line"><span class="cl"><span class="p">,</span> <span class="n">users</span><span class="o">.</span><span class="n">email</span> <span class="n">AS</span> <span class="n">users_email</span>
</span></span><span class="line"><span class="cl"><span class="n">FROM</span> <span class="n">users</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span><span class="mi">859</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="p">[</span><span class="n">generated</span> <span class="ow">in</span> <span class="mf">0.00013</span><span class="n">s</span><span class="p">]</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span><span class="mi">860</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span> <span class="n">ROLLBACK</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">User</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;johndoe@gmail.com&#39;</span><span class="p">)]</span></span></span></code></pre></div></div>
<h2 id="a-final-note-on-switching-out-the-repositories">A final note on switching out the repositories</h2>
<p>In the above commands, I called the repository directly, just to show what the output would be like, and how it returns the <code>User</code> object rather than the ORM object.</p>
<p>But a more desirable pattern is to allow injection of the desired repository into the business logic. Imagine having business logic like below:</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">hashed_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">repository</span><span class="p">:</span> <span class="n">UserRepositoryAbc</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashed_password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_all_users</span><span class="p">(</span><span class="n">repository</span><span class="p">:</span> <span class="n">UserRepositoryAbc</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">()</span></span></span></code></pre></div></div>
<p>Here you can see how the functions default to using our <code>UserRepository</code>, but but they can technically accept any other repository that abides by the abstract class of <code>UserRepositoryAbc</code>.</p>
<p>The above code snippets exhibits &ldquo;Dependency injection&rdquo; by allowing the repository to be provided externally, which promotes loose coupling and flexibility. It also aligns with the &ldquo;Dependency inversion principle&rdquo;, where high-level modules (business logic) should not depend on low-level modules (repositories) directly but should instead depend on abstractions.</p>
<blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg>
    To instantiate or not instantiate
  </div><div class="callout-content"><p>You might have noticed how I&rsquo;ve instantiated the classes in the signatures. This is yet another example of just trying to avoid this blog post from becoming ginormous. Instantiating like this is not desirable but depending on what your needs are like, there are several solutions to this.</p>
<p>For example, you might want to consider using static methods in your repository classes instead, so you don&rsquo;t have to instantiate:</p>
<div class="code-block-wrapper">
  <button class="copy-code-button" aria-label="Copy code to clipboard">
    <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
      <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
    </svg>
    <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </button><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">(</span><span class="n">UserRepositoryAbc</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hashed_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_all_users</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">user</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">()</span></span></span></code></pre></div></div>
<p>Or you can use other mechanisms to determine which repository to be used and instantiate the repositories only once.</p></div>
</blockquote><blockquote class="callout markdown-alert callout-warning markdown-alert-warning"><div class="callout-title markdown-alert-title">
    <svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"></path></svg>
    Caching of instance methods
  </div><div class="callout-content"><p>If you want to implement caching of instance methods, you need to be careful as Python is known for leaking memory when using the <code>@functools.cache</code>. Especially for long-running processes. It all boils down to that the garbage collection doesn&rsquo;t happen.</p>
<p>This is a rabbit hole of itself and I won&rsquo;t dive into it in this blog post 😄.</p></div>
</blockquote><h2 id="over-engineering">Over-engineering</h2>
<p>I would like to end on a note about over-engineering and the tradeoffs of &ldquo;clean code&rdquo;.</p>
<p>Depending on what you&rsquo;re building, the solutions outlined in this blog post might resonate with you or it might make no sense to you what so ever. Perhaps you prefer functional programming and are put off by the object oriented approach here. Perhaps you see the abstraction overhead and loss of performance as a problem.</p>
<p>Regardless, having designed the particular project I&rsquo;m dealing with this way would&rsquo;ve substantially helped replacing the ORM with another one. So I figured I&rsquo;d share this here. Would be super happy for any input or comments on if you see any other ways of dealing with this problem!</p>
<p>Thanks for reading.</p>

</main>





<script>
  (function() {
    const container = document.getElementById('giscus-container');
    const loadBtn = document.getElementById('load-comments-btn');

    
    function loadGiscus() {
      if (!container) return;
      
      
      container.innerHTML = ''; 

      const theme = document.body.classList.contains('dark') ? 'dark' : 'light';
      
      const giscusScript = document.createElement('script');
      giscusScript.src = 'https://giscus.app/client.js';
      giscusScript.setAttribute('data-repo', 'markholloway/markholloway.com');
      giscusScript.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkxMzEwNDU4Njc=');
      giscusScript.setAttribute('data-category', 'General');
      giscusScript.setAttribute('data-category-id', 'DIC_kwDOB8-Z684CU9zc');
      giscusScript.setAttribute('data-mapping', 'title');
      giscusScript.setAttribute('data-strict', '0');
      giscusScript.setAttribute('data-reactions-enabled', '1');
      giscusScript.setAttribute('data-emit-metadata', '0');
      giscusScript.setAttribute('data-input-position', 'bottom');
      giscusScript.setAttribute('data-theme', theme);
      giscusScript.setAttribute('data-lang', 'en');
      giscusScript.setAttribute('crossorigin', 'anonymous');
      giscusScript.async = true;

      container.appendChild(giscusScript);
    }

    
    if (loadBtn) {
      loadBtn.addEventListener('click', loadGiscus);
    }

    
    function setGiscusTheme(theme) {
      const giscusFrame = document.querySelector('iframe.giscus-frame');
      if (giscusFrame && giscusFrame.contentWindow) {
        giscusFrame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          'https://giscus.app'
        );
      }
    }

    
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', () => {
        
        setTimeout(() => {
          const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
          setGiscusTheme(currentTheme);
        }, 10); 
      });
    }

    
    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (!localStorage.getItem('theme')) { 
          const newTheme = event.matches ? "dark" : "light";
          setGiscusTheme(newTheme);
        }
      });
    }
  })();
</script>



<footer>
	<div class="footer-content">
		<span class="footer-icons">
			
			
			<a href="https://github.com/markholloway" target="_blank" rel="noopener" title="GitHub">
				

<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>

			</a>
			
			
			<a href="https://linkedin.com/in/mholloway" target="_blank" rel="noopener" title="LinkedIn">
				

<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>

			</a>
			
			
			<a href="/blog/index.xml" target="_blank" rel="noopener" title="RSS">
				

<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="currentColor"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg>

			</a>
			
			
			<a href="https://cloud.umami.is/share/x4yvhGEscsDh1in8" target="_blank" rel="noopener" title="Umami">
				

<svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="currentColor"><path d="M2.203 8.611H.857a.845.845 0 0 0-.841.841v.858a13.31 13.31 0 0 0-.016.6c0 6.627 5.373 12 12 12 6.527 0 11.837-5.212 11.996-11.701 0-.025.004-.05.004-.075V9.452a.845.845 0 0 0-.841-.841h-1.346c-1.159-4.329-5.112-7.521-9.805-7.521-4.692 0-8.645 3.192-9.805 7.521Zm18.444 0H3.37c1.127-3.702 4.57-6.399 8.638-6.399 4.069 0 7.512 2.697 8.639 6.399Z"/></svg>

			</a>
			
		</span>
		<span class="footer-text">
			© Mark Holloway 2005-2026
		</span>
	</div>
	<script src="/js/main.js"></script>

</footer>
</body>

</html>

