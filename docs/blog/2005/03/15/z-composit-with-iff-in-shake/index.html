<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Z composit with IFF in Shake | Mark Holloway</title><meta name=description content="Notes from a curiosity-driven engineer."><link rel=canonical href=https://markholloway.com/blog/2005/03/15/z-composit-with-iff-in-shake/><meta property="og:url" content="https://markholloway.com/blog/2005/03/15/z-composit-with-iff-in-shake/"><meta property="og:site_name" content="Mark Holloway"><meta property="og:title" content="Z composit with IFF in Shake"><meta property="og:description" content="Utilizing the Z channel (depth information) of Maya’s IFF files in Shake is a bit tricky because of the way Maya stores depth information… here’s a quick tutorial to get you started.
Note This tutorial is applicable on not only Maya’s IFF files but also on other image format files rendered out of other 3D applications. Example files are available for download below. Happy shaking!"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2005-03-15T00:00:00+00:00"><meta property="article:modified_time" content="2005-03-15T00:00:00+00:00"><meta property="article:tag" content="Compositing"><meta name=twitter:card content="summary"><meta name=twitter:title content="Z composit with IFF in Shake"><meta name=twitter:description content="Utilizing the Z channel (depth information) of Maya’s IFF files in Shake is a bit tricky because of the way Maya stores depth information… here’s a quick tutorial to get you started.
Note This tutorial is applicable on not only Maya’s IFF files but also on other image format files rendered out of other 3D applications. Example files are available for download below. Happy shaking!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Z composit with IFF in Shake","datePublished":"2005-03-15T00:00:00Z","dateModified":"2005-03-15T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/markholloway.com\/blog\/2005\/03\/15\/z-composit-with-iff-in-shake\/"},"author":{"@type":"Person","name":"map[]"},"description":"Utilizing the Z channel (depth information) of Maya’s IFF files in Shake is a bit tricky because of the way Maya stores depth information… here’s a quick tutorial to get you started.\nNote This tutorial is applicable on not only Maya’s IFF files but also on other image format files rendered out of other 3D applications. Example files are available for download below. Happy shaking!\n"}</script><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=preload href=/fonts/BerkeleyMono-Variable.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/CommitMono-Variable.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/MapleMono-Italic.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/github-link.css><script defer src=https://cloud.umami.is/script.js data-website-id=c9c97df3-bc05-4b29-8caa-fcf03a05710f></script></head><body class=preload><script>(function(){const e=localStorage.getItem("theme");e?document.body.classList.add(e):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark"),"fonts"in document?Promise.race([document.fonts.ready,new Promise(e=>setTimeout(e,100))]).then(()=>{document.body.classList.remove("preload")}):setTimeout(()=>{document.body.classList.remove("preload")},50)})()</script><nav style=display:flex;align-items:center;gap:1em;flex-wrap:wrap><ul class=menu style=margin:0;padding:0;flex-shrink:0><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><button id=theme-toggle style="background:0 0;border:none;cursor:pointer;font-size:1em;padding:5px;color:inherit">◑</button></li></ul><div id=search style=flex-grow:1;min-width:200px></div></nav><link href=/pagefind/pagefind-ui.css rel=stylesheet><script src=/pagefind/pagefind-ui.js></script><script>window.addEventListener("DOMContentLoaded",e=>{new PagefindUI({element:"#search",showSubResults:!0,showImages:!1,translations:{placeholder:"Search...",clear_search:"×"}}),document.addEventListener("click",e=>{const t=document.querySelector("#search");if(t&&!t.contains(e.target)){const e=t.querySelector(".pagefind-ui__search-clear");e&&e.click()}});const n=document.getElementById("theme-toggle"),t=document.body;n.addEventListener("click",()=>{t.classList.contains("dark")?(t.classList.remove("dark"),t.classList.add("light"),localStorage.setItem("theme","light")):(t.classList.remove("light"),t.classList.add("dark"),localStorage.setItem("theme","dark"))})})</script><div class=article-meta><h1><span class=title>Z composit with IFF in Shake</span></h1><div class=article-meta-info><span class=date>2005-03-15</span>
<span class=article-tags><a href=/tags/compositing>#compositing</a></span></div></div><main data-pagefind-body><aside class=table-of-contents><div class=toc-title><svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z"/></svg>
Table of Contents</div><nav id=TableOfContents><ul><li><a href=#32-bit-floating-point>32-bit floating point</a></li><li><a href=#convert-to-float-space>Convert to float space</a></li><li><a href=#reorder-to-rgb>Reorder to RGB</a></li><li><a href=#multiplying-the-z-channel-using-a-mult-node-with-local-variable>Multiplying the Z channel using a mult node with local variable</a></li><li><a href=#brighten-the-z-channel>Brighten the Z channel</a></li><li><a href=#reorder-back-to-z>Reorder back to Z</a></li><li><a href=#create-a-macro>Create a macro</a></li><li><a href=#depth-shader>Depth shader</a></li></ul></nav></aside><p>Utilizing the Z channel (depth information) of Maya’s IFF files in Shake is a bit tricky because of the way Maya stores depth information… here’s a quick tutorial to get you started.</p><blockquote class="callout markdown-alert callout-note markdown-alert-note"><div class="callout-title markdown-alert-title"><svg class="callout-icon" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" fill="currentColor"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42.0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></svg>
Note</div><div class=callout-content><p>This tutorial is applicable on not only Maya’s IFF files but also on other image format files rendered out of other 3D applications. Example files are available for download below. Happy shaking!</p><ul><li><a href=/blog/assets/zcomp_shake/zCompExample.iff>zCompExample.iff</a> - Maya IIF image</li><li><a href=/blog/assets/zcomp_shake/zCompositeIFF.shk>zCompositeIFF.shk</a> - Shake script</li></ul></div></blockquote><h2 id=32-bit-floating-point>32-bit floating point</h2><p><img src=/blog/assets/zcomp_shake/1_1.gif alt="Shake screenshot"></p><p>Render out your own IFF image using Maya’s batch renderer or use my example (download above) to experiment with. The file above was rendered with mental ray version 3.3.1 for Maya 6.</p><p>Load the IFF image or IFF sequence (containing an alpha channel and a Z channel) into Shake using the FileIn node. The channels of your image are listed in the top of the viewer (in this case RGBAZ).</p><p>Maya always renders the Z channel of IIF files in 32-bit floating point. Other 3D applications can output the Z channel in 8-bit which means that the Z channel is built up of a maximum of 256 shades of gray (2^8 = 256). In high end production this might not be enough to visualize the depth and in that case you can render in 16-bit (2^16 = 65 536 shades of gray) or 32-bit (2^32 = 4 294 967 296 shades of gray) to increase the resolution of the depth.</p><h2 id=convert-to-float-space>Convert to float space</h2><p><img src=/blog/assets/zcomp_shake/1_2.gif alt="Shake screenshot"></p><p>Our Z channel is already 32-bit, but the RGB and the alpha channels are just 8-bit. Create a Bytes node and put it to float space. This will change the bit-depth of your image to 32-bit floating point. Please note that this won’t affect the actual image, just the way it is described. Before, RGB and alpha information was described between 0-256 and we have now converted it into 0-1 where we can drive values above 1 and below 0.</p><h2 id=reorder-to-rgb>Reorder to RGB</h2><p><img src=/blog/assets/zcomp_shake/1_3.gif alt="Shake screenshot"></p><p>Now we will bring the Z channel into RGB so that we easily can perform RGB operations on it. Create a Reorder node and set its channels to zzzz.</p><h2 id=multiplying-the-z-channel-using-a-mult-node-with-local-variable>Multiplying the Z channel using a mult node with local variable</h2><p><img src=/blog/assets/zcomp_shake/1_4.gif alt="Shake screenshot"></p><p>The grayscale depth image should be visible in RGB now, but since Maya stores depth information like this: -1/Z …it will not show up. To correct this we will need to multiply the Z channel with -1 (or in this case the RGB channel since we brought the Z channel into the RGB channels in the previous step). This is something we can do because we are currently in float space!</p><p>Create a Mult node, and inside of it, create a local variable by right-clicking in the Mult’s parameters tab. Let us name the local variable brightness and make it a float.</p><p><img src=/blog/assets/zcomp_shake/1_5.gif alt="Shake screenshot"></p><p>Next, expand the Mult’s color attributes twice until you see the red, green, blue attributes. Into the red attribute textfield type: -1*brightness</p><p>This will change the depth value data from -1/Z to Z. But only for the red channel. Type red into the green and the blue channel to make them inherit the value from the red channel. Now drag the brightness slider around to offset the depth information to a viewable range. Please note that you might have to exceed the slider’s max value quite a lot (depending on the size of your scene). For the IFF file provided at the top of this page, 4 seems to be a good value for the brightness.</p><h2 id=brighten-the-z-channel>Brighten the Z channel</h2><p><img src=/blog/assets/zcomp_shake/1_6.gif alt="Shake screenshot"></p><p>If you are using your own rendered file and keep getting an entirely black image, you need to increase the value of brightness. If your image is all white, you need to lower the value of brightness.</p><p>On a sidenote it is worth mentioning that there is a reason for why we have named the local variable brightness. Brightness is nothing more than a multiplier on the RGB channels …and that’s exactly what we have done here.</p><p>If you like, you can perform aditional RGB operations since all depth information is now in RGB space. Perhaps you want to use an Expand node and/or an Invert node here (to match other render passes). Try to not make the edges of objects in the Z channel anti-aliased as this would move the edges away from its object, depth wise.</p><p>If you used the IFF file in this tutorial, your RGB channel would now look like the image to the left.</p><h2 id=reorder-back-to-z>Reorder back to Z</h2><p><img src=/blog/assets/zcomp_shake/1_7.gif alt="Shake screenshot"></p><p>To transfer the new grayscale depth image to the original image’s Z channel, create a Reorder node (let’s call this Reorder2) and type rrrrr into its channels textfield. Then create a Copy node on its own branch directly under the FileIn node. Put z into the channel textfield of the Copy node. Connect the output from the Reorder2 node to the Copy node. This takes your original image and copies the Z channel from the Reorder2 node. You finally have a Z channel that Shake can do something useful with!</p><h2 id=create-a-macro>Create a macro</h2><p><img src=/blog/assets/zcomp_shake/1_8.gif alt="Shake screenshot"></p><p>If you would like to make a “view Maya Z” macro, you can select the Bytes1, Reorder1 and Mult1 nodes and hit shift-m. This will bring up the create macro dialogue. Scroll down to the Mult1 and expand it. Here you can make the brightness slider visible in the macro by clicking the status icon next to it. Also, you can define a maximum value for the slider instead of 1. Change the macro name and you are ready to start Z-comping that little sucker!</p><h2 id=depth-shader>Depth shader</h2><p><img src=/blog/assets/zcomp_shake/1_9.gif alt="Shake screenshot"></p><p>I should mention that when doing your Z composite, you can also use a depth shader to generate your Z image rather than rendering out the true Z image from within Maya. A depth shader is simply a shader that you assign onto all objects in your scene and with some scripting the output color of the shader will range from black to white (or vice versa). When using a depth shader you won’t always get the true Z depth because the renderer will generate an anti-aliased image (unless you specify otherwise <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>). Having an anti-aliased Z depth could be both good and bad. It could be bad because wherever there is anti-aliasing in the image, effectively there is also a change in Z information. However this might not always be such a bad thing after all since the anti-aliasing itself works as a kind of alpha or Z coverage if you will. A shader that works exactly like this is available for download at highend3d.com in the Maya/shaders section</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>If you set Mental Ray’s anti-alias settings to 0 0, i.e. “Min Sample Level 0” and “Max Sample Level 0” then Mental Ray will cast exactly 1 ray per pixel. This will result in an image which is completely without any anti-aliasing and the depth information is totally exact on a per pixel level. Thanks to Andreas Bauer for pointing this out to me!&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></main><div id=giscus-container class=giscus-comments><div class=load-comments-wrapper><button id=load-comments-btn class=load-comments-btn>Load Comments</button></div></div><script>(function(){const e=document.getElementById("giscus-container"),t=document.getElementById("load-comments-btn");function o(){if(!e)return;e.innerHTML="";const n=document.body.classList.contains("dark")?"dark":"light",t=document.createElement("script");t.src="https://giscus.app/client.js",t.setAttribute("data-repo","fredrikaverpil/fredrikaverpil.github.io"),t.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkxMzEwNDU4Njc="),t.setAttribute("data-category","General"),t.setAttribute("data-category-id","DIC_kwDOB8-Z684CU9zc"),t.setAttribute("data-mapping","title"),t.setAttribute("data-strict","0"),t.setAttribute("data-reactions-enabled","1"),t.setAttribute("data-emit-metadata","0"),t.setAttribute("data-input-position","bottom"),t.setAttribute("data-theme",n),t.setAttribute("data-lang","en"),t.setAttribute("crossorigin","anonymous"),t.async=!0,e.appendChild(t)}t&&t.addEventListener("click",o);function n(e){const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}const s=document.getElementById("theme-toggle");s&&s.addEventListener("click",()=>{setTimeout(()=>{const e=document.body.classList.contains("dark")?"dark":"light";n(e)},10)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";n(t)}})})()</script><footer><div class=footer-content><span class=footer-icons><a href=https://github.com/markholloway target=_blank rel=noopener title=GitHub><svg role="img" viewBox="0 0 24 24" width="1.2em" height="1.2em" fill="currentColor"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
</a><a href=https://linkedin.com/in/markholloway target=_blank rel=noopener title=LinkedIn><svg role="img" viewBox="0 0 24 24" width="1.2em" height="1.2em" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href=/blog/index.xml target=_blank rel=noopener title=RSS><svg role="img" viewBox="0 0 24 24" width="1.2em" height="1.2em" fill="currentColor"><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg>
</a><a href=https://cloud.umami.is/share/x4yvhGEscsDh1in8 target=_blank rel=noopener title=Umami><svg role="img" viewBox="0 0 24 24" width="1.2em" height="1.2em" fill="currentColor"><path d="M2.203 8.611H.857a.845.845.0 00-.841.841v.858a13.31 13.31.0 00-.016.6c0 6.627 5.373 12 12 12 6.527.0 11.837-5.212 11.996-11.701.0-.025.004-.05.004-.075V9.452a.845.845.0 00-.841-.841h-1.346c-1.159-4.329-5.112-7.521-9.805-7.521-4.692.0-8.645 3.192-9.805 7.521zm18.444.0H3.37c1.127-3.702 4.57-6.399 8.638-6.399 4.069.0 7.512 2.697 8.639 6.399z"/></svg>
</a></span><span class=footer-text>© Mark Holloway 2005-2026</span></div><script src=/js/main.js></script></footer></body></html>